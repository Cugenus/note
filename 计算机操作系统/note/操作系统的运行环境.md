
### 处理机运行模式

#### 内核程序、应用程序

- 应用程序
普通程序

- 内核程序
由很多内核程序组成了“操作系统内核”，或简称“内核(Kernel)“；内核是操作系统最重要最核心的部分，也是最接近硬件的部分；甚至可以说，一个操作系统只要有内核就够了(Docker->仅需Linux内核)；操作系统的功能未必都在内核中(如图形化用户界面GUI)
***
#### 特权指令、非特权指令

- 特权
不允许用户直接使用

- 非特权
允许用户直接使用
***
#### 内核态、用户态

- 内核态(管态)
运行内核程序，此时可以执行特权/非特权指令

- 用户态(目态)
运行的是应用程序，此时只能执行非特权指令

- PSW
程序状态字寄存器：程序状态字寄存器中有个二进制位，1表示“内核态”，0表示“用户态”

- 内核态->用户态
执行一条特权指令，修改PSW的标志位为“用户态”，这个动作意味着操作系统将主动让出CPU使用权

- 用户态->内核态
由“中断”引发，硬件自动完成变态过程，触发中断信号意味着操作系统将强行夺回CPU的使用权
***
### 中断、异常

- 中断(外中断)
与当前执行的指令无关，中断信号来源于CPU外部(时钟中断、I/O中断等)；

- 异常(内中断)
与当前执行的指令有关，中断信号来源于CPU内部，自陷(Trap，由陷入指令引发)、故障(Fault，指令执行引起的异常)、终止(Abort，致命错误，内核无法修复)

- 中断向量表
不同的中断信号，需要用不同的中断处理程序(内核态)来处理；当CPU检测到中断信号后，会根据中断信号的类型去查询“中断向量表”，以此来找到相应的中断处理程序在内存中的存放位置
***
### 系统调用

操作系统作为用户和计算机硬件之间的接口，需要向上提供一些简单易用的服务；主要包括命令接口和程序接口，其中，程序接口由一组系统调用组成；应用程序可以通过系统调用来请求获得操作系统内核的服务

- 设备管理
完成设备的 请求/释放/启动 等功能
- 文件管理
完成文件的 读/写/创建/删除 等功能
- 进程控制
完成进程的 创建/撤销/阻塞/唤醒 等功能
- 进程通信
完成进程之间的 消息传递/信号传递 等功能
- 内存管理
完成内存的 分配/回收 等功能

- 系统调用的必要性
应用程序通过系统调用请求操作系统的服务，而系统中的各种共享资源都由操作系统内核统一掌管，因此凡是与共享资源有关的操作(存储分配、I/O操作、文件管理等)，都必须通过系统调用的方式向操作系统内核提出服务请求，由操作系统内核代为完成，以保证系统的稳定性和安全性，防止用户进行非法操作

- 系统调用的过程
前期处理相关指令->传参指令->陷入指令->后续处理相关指令；
发出系统调用请求是在用户态，而对系统调用的相应处理在核心态下进行；
陷入指令是在用户态执行的，执行陷入指令之后立即引发一个内中断，使CPU进入核心态运行处理系统调用的内核程序
***



