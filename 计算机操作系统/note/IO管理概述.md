
### I/O设备的基本概念

I/O设备就是可以将数据输入到计算机，或者可以接收计算机输出数据的外部设备，属于计算机中的硬件部件；I/O设备由机械部件和电子部件(I/O控制器、设备控制器)组成

I/O设备的机械部件主要用来执行具体I/O操作
I/O设备的电子部件通常是一块插入主板扩充槽的印刷电路板

- 阻塞I/O
应用程序发出I/O系统调用，进程需转为阻塞态等待

- 非阻塞I/O
应用程序发出I/O系统调用，系统调用可迅速返回，进程无需阻塞等待
***
### I/O设备的分类

- 按使用特性分类
人机交互类外部设备
存储设备
网络通信设备

- 按传输速率分类
低速设备
中速设备
高速设备

- 按信息交换的单位分类
块设备
字符设备
***
### I/O控制器

CPU无法直接控制I/O设备的机械部件，因此I/O
设备还要有一个电子部件作CPU和I/O设备机械部件之间的“中介”，用于实现CPU对设备的控制；这个电子部件就是I/O控制器，又称设备控制器，CPU可控制I/O控制器，又由I/O控制器来控制设备的机械部件
#### I/O控制器的功能

- 接受和识别CPU发出的命令
I/O控制器中会有相应的控制寄存器来存放命令和参数

- 向CPU报告设备的状态
I/O控制器中会有相应的状态寄存器用于记录I/O设备的当前状态

- 数据交换
I/O控制器中会设置相应的数据寄存器；输出时：数据寄存器用于暂存CPU发来的数据，之后再由控制器传送设备，输入时：数据寄存器用于暂存设备发来的数据，之后CPU从数据寄存器中取走数据

- 地址识别
为了区分设备控制器中的各个寄存器，也需要给各个寄存器设置一个特定的“地址”；I/O控制器通过CPU提供的“地址”来判断CPU要读/写的是哪个寄存器
#### I/O控制器的组成

- CPU与控制器的接口
用于实现CPU与控制器之间的通信；CPU通过控制线发出命令，通过地址线指明
要操作的设备，通过数据线来取出/输入数据，或放入/输出数据

- I/O逻辑
负责接收和识别CPU的各种命令(如地址译码) ，对设备发出命令并负责

- 控制器与设备的接口
用于实现控制器与设备之间的通信
#### 寄存器编址

一个I/O控制器可能会对应多个设备，数据寄存器、控制寄存器、状态寄存器可能有多个，且这些寄存器都要有相应的地址，才能方便CPU操作

- 内存映像I/O
控制器中的寄存器与内存地址统一编址，可以采用对内存进行操作的指令来对控制器进行操作

- 寄存器独立编址
控制器中的寄存器使用单独的地址，需要设置专门的指令来操作控制器
***
### I/O控制方式

#### 程序直接控制方式

- 完成一次读/写操作的流程
![[Pasted image 20240604232757.png]]

- CPU干预的频率
很频繁，I/O操作开始之前、完成之后需要CPU介入，并且在等待I/O完成的过程中CPU需要不断地轮询检查

- 数据传送的单位
每次读/写一个字

- 数据的流向
读操作(数据输入)：I/O设备->CPU->内存
写操作(数据输出)：内存->CPU->I/O设备
每个字的读/写都需要CPU的帮助

- 特点
优点：实现简单
缺点：CPU和I/O设备只能串行工作，CPU需要一直轮询检查长期处于“忙等”状态 ，CPU利用率低
#### 中断驱动方式

- 完成一次读/写操作的流程
![[Pasted image 20240604233138.png]]

- CPU干预的频率
每次I/O操作开始之前、完成之后需要CPU介入，等待I/O完成的过程中CPU可以切换到别的进程执行

- 数据传送的单位
每次读/写一个字

- 数据的流向
读操作(数据输入)：I/O设备->CPU->内存
写操作(数据输出)：内存->CPU->I/O设备
每个字的读/写都需要CPU的帮助

- 特点
优点：CPU和I/O设备可并行工作，CPU利用率得到明显提升
缺点：每个字在I/O设备与内存之间的传输，都需要经过CPU，而频繁的中断处理会消耗较多的CPU时间
#### DMA方式

- 完成一次读/写操作的流程
![[Pasted image 20240604233607.png]]

- CPU干预的频率
仅在传送一个或多个数据块的开始和结束时，才需要CPU干预

- 数据传送的单位
每次读/写一个或多个块(每次读写的只能是连续的多个块且这些块读入内存后在内存中也必须是连续的)

- 数据的流向
读操作(数据输入)：I/O设备->内存
写操作(数据输出)：内存->I/O设备

- 特点
优点：数据传输以“块”为单位，CPU介入频率进一步降低；数据的传输不再需要先经过CPU再写入内存，数据传输效率进一步增加；CPU和I/O设备的并行性得到提升
缺点：CPU每发出一条I/O指令，只能读/写一个或多个连续的数据块
#### 通道控制方式

- 完成一次读/写操作的流程
![[Pasted image 20240604234545.png]]

- CPU干预的频率
极低，通道会根据CPU的指示执行相应的通道程序，只有完成一组数据块的读/写后才需要发出中断信号，请求CPU干预

- 数据传送的单位
每次读/写一组数据块

- 数据的流向
读操作(数据输入)：I/O设备->内存
写操作(数据输出)：内存->I/O设备

- 特点
缺点：实现复杂，需要专门的通道硬件支持
优点：CPU、通道、I/O设备可并行工作，资源利用率很高
***
