
### 调度的概念

- 基本概念
确定某种规则来决定处理作业的顺序
作业：一个具体的任务

- 高级调度(作业调度)
按一定的原则从外存的作业后备队列中挑选一个作业调入内存，并创建进程；每个作业只调入一次，调出一次；作业调入时会建立PCB，调出时才撤销PCB

- 中级调度(内存调度)
按照某种策略决定将哪个处于挂起状态的进程重新调入内存；一个进程可能会被多次调出、调入内存，因此中级调度发生的频率要比高级调度更高

- 低级调度(进程调度)
按照某种策略从就绪队列中选取一个进程，将处理机分配给它；进程调度是操作系统中最基本的一种调度，在一般的操作系统中都必须配置进程调度，进程调度的频率很高

![[Pasted image 20240509220729.png]]

- 七状态模型
![[Pasted image 20240509220430.png]]
挂起状态是将进程映像调到外存中

- 调度器/调度程序
调度程序决定：调度算法、时间片大小；
创建新进程、进程退出、运行进程阻塞、I/0中断发生会触发调度器

- 闲逛进程
没有其他就绪进程时，运行闲逛进程(idle)；
特点：优先级最低、可以是0地址指令，占一个完整的指令周期(指令周期末尾例行检查中断)、能耗低
***
### 调度的实现

#### 时机

- 需要调度的情况
1、当前运行的进程**主动放弃**处理机；
进程正常终止、运行过程中发生异常而终止、进程主动请求阻塞(如等待I/0)
2、当前运行的进程**被动放弃**处理机；
分给进程的时间片用完、有更紧急的事需要处理(如I/O中断)、有更高优先级的进程进入就绪队列；

- 不能调度的情况
1、在处理中断的过程中(中断处理过程复杂，与硬件密切相关，很难做到在中断处理过程中进行进程切换)；
2、进程在操作系统内核程序临界区中；
3、在原子操作过程中(原语)；
#### 方式

- 非剥夺调度方式(非抢占方式)
只允许进程主动放弃处理机；

实现简单，系统开销小但是无法及时处理紧急任务，适合于早期的批处理系统

- 剥夺调度方式(抢占方式)
允许进程被动放弃处理机；

可以优先处理更紧急的进程，也可实规让各进程按时间片轮流执行的功能 (通过时钟中断)，适合于分时操作系统、实时操作系统
#### 切换

- 进程切换
指一个进程让出处理机，由另一个进程占用处理机的过程；主要包括了对原来运行进程各种数据的保存，和对新的进程各种数据的恢复

- 狭义进程调度
从就绪队列中选中一个要运行的进程

- 广义进程调度
包含了选择一个进程和进程切换两个步骤
***
### 典型调度算法

#### 调度算法的评价指标

- CPU利用率
$CPU=\frac{忙碌的时间}{总时间}$

- 系统吞吐量
$系统吞吐量=\frac{完成作业数}{花费时间}$

- 周转时间
$周转时间 =作业完成时间-作业提交时间$
$平均周转时间 =\frac{各作业周转时间之和} {作业数}$

$带权周转时间 =\frac{作业周转时间} {作业实际运行的时间}=\frac{作业完成时间-作业提交时间}{作业实际运行的时间}$

- 等待时间
指进程建立后等待被服务的时间之和；在等待I/O完成的期间其实进程也是在被服务的，所以不计入等待时间

- 响应时间
指从用户提交请求到首次产生响应所用的时间
#### 调度算法

##### 适用于早期批处理系统的调度算法

###### 先来先服务

- 算法规则
按照作业/进程到达的先后顺序进行服务

- 作业/进程
用于作业调度时，考虑的是哪个作业先到达后备队列；用于进程调度时，考虑的是哪个进程先到达就绪队列

- 是否可抢占
非抢占式

- 特点
优点：公平、算法实现简单
缺点：对长作业有利，对短作业不利

- 是否导致饥饿
不会
###### 最短作业优先

- 算法规则
最短的作业/进程优先得到服务

- 作业/进程
既可用于作业调度，也可用于进程调度；用于进程调度时称为短进程优先(SPF，Shortest Process First)算法

- 是否可抢占
默认SJF和SPF是非抢占式的算法；但是也有抢占式的版本：最短剩余时间优先算法(SRTN，Shortest Remaining Time Next)

- 特点
优点：平均等待时间短、平均周转时间短
缺点：不公平；对短作业有利，对长作业不利；可能产生饥饿现象；作业/进程的运行时间是由用户提供的，并不一定真实，不一定能做到真正的短作业优先

- 是否导致饥饿
会
###### 最高响应比优先

- 算法规则
在每次调度时先计算各个作业/进程的响应比，选择响应比最高的作业/进程为其服务；$响应比 =\frac{等待时间+要求服务时间}{要求服务时间}$

- 作业/进程
既可用于作业调度，也可用于进程调度

- 是否可抢占
非抢占式

- 特点
折中考虑了等待时间和运行时间，避免了长作业饥饿的问题

- 是否导致饥饿
不会
##### 适用于交互式系统

###### 时间片轮转

- 算法规则
按照各进程到达就绪队列的顺序，轮流让各个进程执行一个时间片

- 作业/进程
用于进程调度(只有作业放入内存建立了相应的进程后才能被分配处理机时间片)

- 是否可抢占
抢占式

- 特点
优点：公平；响应快，适用于分时操作系统
缺点：由于高频率的进程切换，因此有一定开销；不区分任务的紧急程度

- 是否导致饥饿
不会
###### 优先级调度

- 算法规则
每个作业/进程有各自的优先级，调度时选择优先级最高的
静态优先级：创建进程时确定，之后一直不变
动态优先级：创建进程时有一个初始值，之后会根据情况动态地调整优先级

- 作业/进程
用于作业调度、进程调度、I/O调度

- 是否可抢占
抢占式、非抢占式都有

- 特点
优点：用优先级区分紧急程度、重要程度，适用于实时操
缺点：会导致饥饿

- 是否导致饥饿
会
###### 多级反馈队列调度

- 算法规则
1、设置多级就绪队列，各级队列优先级从高到低，时间片从小到大
2、新进程到达时先进入第1级队列，按FCFS原则排队等待被分配时间片，若用完时间片进程还未结束，则进程进入下一级队列队尾，如果此时已经在最下级的队列，则重新放回最下级
3、只有第k 级队列为空时，才会为 k+1 级队头的进程分配时间
4、被抢占处理机的进程重新放回原队列队尾

- 作业/进程
用于进程调度

- 是否可抢占
抢占式

- 特点
对各类型进程相对公平；不必实现估计进程的运行时间(避免用户作假)；可灵活地调整对各类进程的偏好程度

- 是否导致饥饿
会
***