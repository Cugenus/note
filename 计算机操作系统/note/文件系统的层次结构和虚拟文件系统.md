
### 文件系统的层次结构

- 用户接口
文件系统需要向上层的用户提供一些简单易用的功能接口，这层就是用于处理用户发出的系统调用请求

- 文件目录系统
用户是通过文件路径来访问文件的，因此这一层需要根据用户给出的文件路径找到相应的FCB或索引结点，所有和目录、目录项相关的管理工作都在本层完成

- 存取控制模块
为了保证文件数据的安全，还需要验证用户是否有访问权限，这一层主要完成了文件保护相关功能

- 逻辑文件系统
用户指明想要访问文件记录号，这一层需要将记录号转换为对应的逻辑地址

- 物理文件系统
这一层需要把上一层提供的文件逻辑地址转换为实际的物理地址

- 辅助分配模块
负责文件存储空间的管理，即负责分配和回收存储空间

- 设备管理模块
直接与硬件交互，负责和硬件直接相关的一些管理工作，如：分配设备、分配设备缓冲区、磁盘调度、启动设备、释放设备等

![[Pasted image 20240603192412.png]]
***
### 文件系统布局

- 文件系统在外存中的结构
物理格式化：划分扇区，检测坏扇区，并用备用扇区替换坏扇区
逻辑格式化：![[Pasted image 20240603202208.png]]

- 文件系统在内存中的结构
安装表
目录的缓存
系统的打开文件表
进程的打开文件表
***
### 虚拟文件系统

- 虚拟文件系统
1、向上层用户进程提供统一标准的系统调用接口，屏蔽底层具体文件系统的实现差异
2、一个新的文件系统想要在某操作系统上被使用，就必须满足该操作系统VFS的要求
3、每打开一个文件，VFS就在主存中新建一个 vnode，用统一的数据结构表示文件，无论该文件存储在哪个文件系统

- 文件系统挂载
即文件系统安装/装载，如何将一个文件系统挂载到操作系统中

1、在VFS中注册新挂载的文件系统；内存中的挂载表(mount table)包含每个文件系统的相关信息，包括文件系统类型、容量大小等
2、新挂载的文件系统，要向VFS提供一个函数地址列表
3、将新文件系统加到挂载点(mount point)，也就是将新文件系统挂载在某个父目录下
***
